record(bi, PLC-$(SUBS):status) {
  field(DTYP, "S7plc stat")
  field(INP, "@PLC:$(SUBS)")
  field(SCAN, "I/O Intr")
  field(ZNAM, "disconnected")
  field(ONAM, "connected")
  field(ZSV, "MAJOR")
  field(FLNK, "PLC-$(SUBS):status-counter")
}

record(calc, PLC-$(SUBS):status-counter) {
  field(INPA, "PLC-$(SUBS):status-counter")
  field(CALC, "A+1")
  field(FLNK, "PLC-$(SUBS):disconnect-counter")
}


record(calc, PLC-$(SUBS):disconnect-counter) {
  field(INPA, "PLC-$(SUBS):status")
  field(INPB, "PLC-$(SUBS):disconnect-counter.LA")
  field(INPC, "PLC-$(SUBS):disconnect-counter")
  field(CALC, "(A=0&&B=1)?C+1:C")
}

record(waveform, PLC-$(SUBS):Status:Buffer) {
  field(DTYP, "S7plc")
  field(INP, "@PLC:$(SUBS)/0 T=UINT16")
  field(FTVL, "SHORT")
  field(NELM, "110")
  field(SCAN, "I/O Intr")
}

 record(mbbi, "HPRF-$(SUBS):Ampl:sType") {
  field (DTYP, "S7plc")
  field (INP,  "@$PLC:$(SUBS)/13 T=BYTE")
  field (SCAN, "I/O Intr")
  field (NOBT, "2")
  field (SHFT, "0")
  field (ZRVL, "0")
  field (ONVL, "1")
  field (TWVL, "2")
  field (ZRST, "Normal")
  field (ONST, "Slave")
  field (TWST, "Master")
 }

record(calc, HPRF-$(SUBS):Fil:sRdy) {
  field(INPA, "HPRF-$(SUBS):Fil:sPreheat")
  field(INPB, "HPRF-$(SUBS):Ampl:sOn")
  field(CALC, "(A=0&&B=1)?1:0")
  field(SCAN, "1 second")
}
